# Twilio SMS Connector

This connector allows Einstein chatbots to be accessed using text messages. It uses Twilio's services to forward messages to and from the chatbots.

## Prerequisites

Before you can run this app, you need to

* [Create a Connected App to Access Einstein Bot APIs](https://developer.salesforce.com/docs/service/einstein-bot-api/guide/prerequisites.html#step-1:-create-a-connected-app)
* [Configure an Einstein Bot](https://developer.salesforce.com/docs/service/einstein-bot-api/guide/prerequisites.html#step-2:-configure-an-einstein-bot)
* Create a Twilio account, claim a phone number, and configure the corresponding webhook to point to your web-service url.

## Einstein Bot setup
Configure the following properties in `application.properties` to properly connect with Einstein bot. This connector is setup to work with only one Einstein bot.
1. `sfdc.einstein.bots.force-config-endpoint`: Salesforce instance endpoint. This can be obtained from connections screen in bots setup page. Please refer to developer [documentation](https://developer.salesforce.com/docs/service/einstein-bot-api/guide/prerequisites.html)
2. `sfdc.einstein.bots.orgId`: Salesforce OrgId (18 chars)
3. `sfdc.einstein.bots.botId`: Salesforce bot ID. Refer to this [documentation](https://developer.salesforce.com/docs/service/einstein-bot-api/guide/get-started.html#begin-a-new-session) on how to get this ID.
   Other properties related to connected app should be configured as explained [here](https://developer.salesforce.com/docs/service/einstein-bot-api/guide/get-started.html#begin-a-new-session).

## Twilio Setup
Create an account at [Twilio] (www.twilio.com) and get a virtual Twilio phone number. This phone number will be used to send and receive text messages to the chatbot. Record the account's SID and authorization token from `API keys and tokens` section of Settings. It will be used by the demo connecotor to use TWilio's REST API and must be set in `application.properties` in the following fields:
1. `twilio.account-sid`: set it to your Twilio account's SID. 
2. `twilio-auth-keys`: set it to you account's auth token.

## Setting up a public URL for your service
The demo connector must have a public endpoint which will be used by Twilio for communication when an SMS is received on the virtual phone number. If the connector is hosted on the web, e.g. Heroku, then the public endpoint for the hosted service will be used to configure the virtual phone number's webhook target. 

For demos and devbox testing, the connector will generally be run on a local laptop or desktop. For these scenarios, an [NGrok](ngrok.com) proxy can be setup to expose the local server ports to a public url. 

[Download](https://ngrok.com/download) and install NGrok if you are running the connector locally and do not have a public HTTP endpoint. 

Once ngrok is installed and setup, executing `ngrok http 8080` from command line will create a public url (under the heading `Forwarding` in the console) which will be tunneled to your local host at port 8080. This public url will be in the form of `http://*.ngrok.io` where `*` will be a custom string generated during each execution. For the rest of this documentation, replace the `*` in the url with the unique string generated by ngrok. Keep this console open and running during the demo. Some vpn services block ngrok tunnels so make sure to verify the availability of your public endpoint e.g. from a browser.

## Running the example
* Update [application.properties](src/main/resources/application.properties) according to your setup.
* Build your application in your desired development environment or `mvn install` if using maven.
* Execute `ngrok http 8080` to start a ngrok session. This example assumes the default port of 8080 is used by Spring Boot.  
* In Twilio's phone number setting, configure the webhook corresponding to the section `A MESSAGE COMES IN` to type `HTTP GET` and set it to the public url created by ngrok,   `http://*.ngrok.io/bot/twiml` in this example.
* Run spring boot application using maven `mvn spring-boot:run`
* The demo can be tested by visiting `http://localhost:8080/bot/twiml/?From=123456789&Body=hello` locally and `http://*.ngrok.io/bot/twiml?From=123456789&Body=hello` through the web.  
* At this point, the bot can also be reached by sending a text message to the Twilio virtual phone number.


